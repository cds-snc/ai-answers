version: '3.8'

services:
  mongo:
    image: mongo:6.0
    container_name: mongodb
    restart: unless-stopped
    ports:
      - "27017:27017"
      #environment:
      # Change these for production; consider using an .env file or Docker secrets
      #MONGO_INITDB_ROOT_USERNAME: root
      #MONGO_INITDB_ROOT_PASSWORD: example
    volumes:
      # Use a named volume instead of a direct Windows host bind mount.
      # This prevents "Operation not permitted" errors caused by MongoDB's 
      # WiredTiger engine trying to allocate new files on NTFS folders.
      - mongo_data:/data/db
  qdrant:
    image: qdrant/qdrant
    container_name: qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage

  redis:
    image: redis:7.2
    container_name: redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

# We are using named volumes for persistent storage.
# This ensures that OS-level permission issues (like NTFS/Docker file mapping)
# do not interfere with database operations like creating new collections.
volumes:
  mongo_data:
  qdrant_data:
  redis_data:
