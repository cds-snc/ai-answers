FROM public.ecr.aws/lambda/nodejs:20

ENV NODE_ENV=production
ENV REACT_APP_ENV=production

# Download DocumentDB TLS certificate
RUN curl -o /app/global-bundle.pem https://truststore.pki.rds.amazonaws.com/global/global-bundle.pem

# Copy source and install dependencies
COPY . ${LAMBDA_TASK_ROOT}
WORKDIR ${LAMBDA_TASK_ROOT}

RUN npm install
RUN npm run build

# Install aws-serverless-express for Lambda integration
RUN npm install aws-serverless-express

CMD ["lambda-handler.handler"]